<script src="https://zclarke.xyz/threadpool.js/index.js"></script>
<script type="text/javascript">

var threadpool=new ThreadPool();

var input="(* 10 (+ 9 1))"
input="("+input+")";
input=replaceAll(input,"(","[\"");
input=replaceAll(input,")","\"]");
input=replaceAll(input," ","\",\"");
input=replaceAll(input,"\n","");


input=replaceAll(input,"\"[","[");
input=replaceAll(input,"]\"]","]]");
input=replaceAll(input,"]\",","],");
input=replaceAll(input,"][","],[");


code=JSON.parse(input);


console.log(code);

console.log(evaluate(code));


function evaluate(arr){
  console.log(arr);
  if(arr.constructor===Array){
    if(arr[0]=="define"){//Dont evaluate Define

    }else
    if(arr[0].constructor===Array&&arr[0][0]=="lambda"){//Function Expression

    }else{

    }
    //Evaluate Sub Expressions
    arr=arr.map(function(x){
      var y=x.slice();
      return evaluate(y);
    });
    //Evaluate Expression
    arr=runCommand(arr);
    console.log(arr);
    return arr;
  }else{//Value
    if(!isNaN(arr)){//Number
      return parseInt(arr);
    }

    return arr;
  }
}

function runCommand(ls){
  console.log("run cmd",ls);
  var arr=ls.slice();
  switch(arr[0]){
    case "+":
      return arr[1]+arr[2];
    break;
    case "*":
      return arr[1]*arr[2];
    break;
    default:

  }
}


function replaceAll(str,oldStr,newStr){
  while(str.indexOf(oldStr)!=-1){
    str=str.replace(oldStr,newStr);
  }
  return str;
}
</script>
